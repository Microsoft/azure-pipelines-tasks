{
    "id": "ad884ca2-732e-4b85-b2d3-ed71bcbd2788",
    "name": "npmAuthenticate",
    "friendlyName": "npm Authenticate",
    "description": "Authenticate a npmrc for tasks which use npm.",
    "helpMarkDown": "[More Information](https://go.microsoft.com/fwlink/?LinkID=613746)",
    "category": "Package",
    "author": "Microsoft Corporation",
    "version": {
        "Major": 1,
        "Minor": 0,
        "Patch": 0
    },
    "runsOn": [
        "Agent",
        "DeploymentGroup"
    ],
    "demands": [
        "npm"
    ],
    "minimumAgentVersion": "1.91.0",    
    "instanceNameFormat": "npm Authenticate",
    "inputs": [
        {
            "name": "workingDir",
            "label": ".npmrc file to authenticate",
            "helpMarkDown": "Path to the target .npmrc file. Select the file, not the folder e.g. \"/packages/mypackage.npmrc\".",
            "type": "filePath"
        },
        {
            "name": "customEndpoint",
            "label": "Credentials for registries outside this account/collection",
            "helpMarkDown": "Credentials to use for external registries located in the project's .npmrc. For registries in this account/collection, leave this blank; the buildâ€™s credentials are used automatically.",
            "type": "connectedService:externalnpmregistry",
            "properties": {
                "MultiSelectFlatList": "true"
            }
        }
    ],
    "dataSourceBindings": [
        {
            "target": "customFeed",
            "endpointId": "tfs:feed",
            "endpointUrl": "{{endpoint.url}}/_apis/packaging/feeds",
            "resultSelector": "jsonpath:$.value[*]",
            "resultTemplate": "{ \"Value\": \"{{{id}}}\", \"DisplayValue\": \"{{{name}}}\"}"
        },
        {
            "target": "publishFeed",
            "endpointId": "tfs:feed",
            "endpointUrl": "{{endpoint.url}}/_apis/packaging/feeds",
            "resultSelector": "jsonpath:$.value[*]",
            "resultTemplate": "{ \"Value\": \"{{{id}}}\", \"DisplayValue\": \"{{{name}}}\"}"
        }
    ],
    "execution": {
        "Node": {
            "target": "npmauth.js"
        }
    },
    "messages": {
        "FoundBuildCredentials": "Found build credentials",
        "NoBuildCredentials": "Could not find build credentials",
        "UnknownCommand": "Unknown command: %s",
        "MultipleProjectConfigs": "More than one project .npmrc found in $s",
        "ServiceEndpointNotDefined": "Couldn't find Service Endpoint, make sure the selected endpoint still exists.",
        "NpmrcNotNpmrc": "The file you selected to authenticate (%s) is not a valid .npmrc file.",
        "ServiceEndpointUrlNotDefined": "Couldn't find Url for Service Endpoint, make sure Service Endpoint is correctly configured.",
        "SavingFile": "Saving file %s",
        "RestoringFile": "Restoring file %s",
        "PublishFeed": "Publishing to internal feed",
        "PublishExternal": "Publishing to external registry",
        "UseFeed": "Using internal feed",
        "UseNpmrc": "Using registries in .npmrc",
        "PublishRegistry": "Publishing to registry: %s",
        "UsingRegistry": "Using registry: %s",
        "AddingAuthRegistry": "Adding auth for registry: %s",
        "FoundLocalRegistries": "Found %d registries in this account/collection",
        "AddingLocalCredentials": "Adding credentials for a local registry",
        "AddingEndpointCredentials": "Adding credentials for the %s endpoint",
        "AuthenticatingThisNpmrc": "Adding authentication to the .npmrc file at %s",
        "IgnoringRegistry": "No service endpoints that matched %s were found",
        "ForcePackagingUrl": "Packaging collection url forced to: %s",
        "DebugLogNotFound": "Couldn't find a debug log in the cache or working directory",
        "NpmFailed": "Npm failed with return code: %s",
        "FoundNpmDebugLog": "Found npm debug log, make sure the path matches with the one in npm's output: %s",
        "TestDebugLog": "Trying debug log location: %s",
        "OverridingProjectNpmrc": "Overriding project .npmrc: %s",
        "RestoringProjectNpmrc": "Restoring project .npmrc",
        "WorkingDirectoryNotDirectory": "Please change your working directory to a valid directory",
        "CheckedInCredentialsOverriden": "We found credentials for the %s registry in the selected .npmrc file and have overriden them",
        "NoIndex.jsonFile": "No index.json file was found and no files were restored",
        "UndidChangesToNpmrc" : "undid changes made to %s since the first time npm Authenticate acted upon the file."
    },
    "postjobexecution": {
        "Node": {
            "target": "npmauthcleanup.js",
            "argumentFormat": ""
        }

    }
}
